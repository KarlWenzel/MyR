---
title: "Plotting"
output: 
  html_document:
    keep_md: yes
    toc: yes
    toc_depth: 4
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Base Plot System

Basic plotting methods:

- `hist()`
- `plot()`
- `boxplot()`
- and multiple helpers, like `lines(), points(), text(), title(), mtext(), axis()`

Key plot parameters

- `pch` (i.e. plot char) [pch values](./pch.png)
- `lty` (i.e. line type)
- `lwd` (i.e. line width)
- `col` (i.e. color)
- `xlab` (i.e. x-axis label)
- `ylab` (i.e. y-axis label)

Values for pch:

    
```{r basics}
# We will use the airquality data frame for our plotting purposes
library(datasets)
df.AQ = airquality # Short names for data frames are much nicer
str( df.AQ )
```

[top](#header)

#### Base Histogram

```{r base-histogram}
# Draw a histogram
hist( df.AQ$Ozone )
```

[top](#header)

#### Base Scatterplot

```{r base-scatterplot}
# Draw a scatterplot
plot( df.AQ$Wind, df.AQ$Ozone )
title( main = "Ozone and Wind in New York City" )
```

[top](#header)

#### Scatterplot with Colors

```{r scatter-with-col}
# Create a logical vector to be used as a filter momentarily
is5 = ( df.AQ$Month == 5 )

# Draw a scatterplot again
#   note that type="n" sets up the plot, but does not draw points
plot( df.AQ$Wind, df.AQ$Ozone, main="Ozone and Wind in NYC", type="n" )
points( df.AQ[is5,]$Wind, df.AQ[is5,]$Ozone, col="blue" )
points( df.AQ[!is5,]$Wind, df.AQ[!is5,]$Ozone, col="red" )
legend("topright", pch=1, col=c("blue", "red"), legend=c("May", "Other Months"))
```

[top](#header)

#### Scatterplot with Regression Line

``` {r scatter-with-reg}
# Draw a scatterplot with regression line
plot( df.AQ$Wind, df.AQ$Ozone, main="Ozone and Wind in NYC", pch=20 ) 
model = lm( Ozone ~ Wind, df.AQ )
abline( model, lwd=2 )
```

[top](#header)

#### Base Boxplot

```{r base-boxplot}
# Draw a boxplot
df.AQ$Month = as.factor( df.AQ$Month )
boxplot( Ozone ~ Month, df.AQ, xlab="Month", ylab="Ozone (ppb)" )
```

[top](#header)

#### Multiple Base Plots

```{r multi-base}
# Draw multiple plots on single device
par( mfrow = c(1,2) )
plot( df.AQ$Wind, df.AQ$Ozone, main="Ozone and Wind" )
plot( df.AQ$Solar.R, df.AQ$Ozone, main="Ozone and Solar Radiation" )

# Set parameter back to single plot
par( mfrow = c(1,1) )
```

[top](#header)

### Plotting to Devices

It is possible to manage multiple devices for plotting

- To manage multiple devices, use dev.cur() and dev.set()
- To copy between devices, dev.copy() and dev.copy2pdf()
    
```{r plot-to-dev}

# Draw to a file graphics device instead of default screen graphics device
pdf( file="example.pdf" )
x = rnorm(100)
hist(x)
print( dev.cur() )

dev.off() #closes file device
```
The PDF is [here.](#example.pdf)

[top](#header)

### ggplot2

1. Two main functions: 

    - `qplot()`
    - `ggplot()`
    
2. Main parameters:

    - data, generally a data.frame
    - aesthetic mappings
    - geoms (e.g. points, lines, shapes)
    - facets (i.e. condition)
    - stats (e.g. binning, quantiles, smoothing)
    - scales
    - coord systems
    - labels (e.g. `xlab(), ylab(), ggtitle()`_
    - themes
        - `theme()` for global tweaking
        - general themes e.g. `theme_gray(), theme_bw(), ` ... etc.
        
3. Build using layers:

    - plot data
    - overlay summary
    - metadata and annotation

```{r my-ggplot2}
library(ggplot2) # comes with mpg data set
df.MPG = mpg     # make a copy to play with, using our preferred naming convention
str(df.MPG)
```

[top](#header)

#### qplot

```{r qplot-basics}
# Scatterplot
p <- qplot(displ, hwy, data = df.MPG)
print(p)

# Scatterplot with color codes based on type of drive
p <- qplot(displ, hwy, data = df.MPG, color=drv)
print(p)

# add a "smoother" for 95% confidence interval
p <- qplot(displ, hwy, data = df.MPG, geom = c("point", "smooth"))
print(p)

# Histogram (inferred by single dimension provided)
#   For all of these histograms, specify a binwidth of bins to avoid warning
p <- qplot(hwy, data = df.MPG, binwidth=2)
print(p)

# Histogram with color coding of subsets
p <- qplot(hwy, data = df.MPG, binwidth=2, fill=drv)
print(p)

# histogram with facets i.e. panels, in this case spanning HORIZONTALLY
p <- qplot(hwy, data = df.MPG, binwidth=2, fill=drv, facets = . ~ drv)
print(p)

# histogram with facets i.e. panels, in this case spanning VERTICALLY
p <- qplot(hwy, data = df.MPG, binwidth=2, fill=drv, facets = drv ~ .)
print(p)
```

[top](#header)

#### ggplot

```{r qqplot-basics}
# We will use the airquality dataset for this portion
library(datasets)
df.AQ = airquality
df.AQ$Month = as.factor(df.AQ$Month)
str( df.AQ )

# no actual plot yet, but still has cool summary
p = ggplot( data = df.AQ, aes(Wind,Ozone) )
summary(p)

# now we added a plot
p = ggplot( data = df.AQ, aes(Wind,Ozone) )  
p = p + geom_point()
print(p)

# add a smoother now
p = ggplot( data = df.AQ, aes(Wind,Ozone) )  
p = p + geom_point()   
p = p + geom_smooth(method = "lm")
print(p)

# now add facets (by month, i.e. condition our plot by month)
p = ggplot( data = df.AQ, aes(Wind,Ozone) )  
p = p + geom_point()   
p = p + geom_smooth(method = "lm")  
p = p + facet_grid(. ~ Month)
print(p)

# add manual limits for fun
p = ggplot( data = df.AQ, aes(Wind,Ozone) )  
p = p + geom_point()   
p = p + geom_smooth(method = "lm")  
p = p + facet_grid(. ~ Month)  
p = p + ylim(-10, 50)
print(p)

# How to condition (i.e. add facets) for continuous data?  use the cut() function to add column
# lets condition on Temp instead of Month
cutpoints <- quantile(df.AQ$Temp, seq(0,1, length=4), na.rm=TRUE)
df.AQ$TempDec <- cut(df.AQ$Temp, cutpoints)
levels(df.AQ$TempDec)

# Now we can plot
p = ggplot( data = df.AQ, aes(Wind,Ozone) )  
p = p + geom_point()   
p = p + geom_smooth(method = "lm")  
p = p + facet_grid(. ~ Month)
print(p)

# Create a 2-dimensional facet and condition on month and tempurature decile
p = ggplot( data = df.AQ, aes(Wind,Ozone) )  
p = p + geom_point()   
p = p + geom_smooth(method = "lm")  
p = p + facet_grid(Month ~ TempDec)
print(p)
```

[top](#header)